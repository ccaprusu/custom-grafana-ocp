<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="generator" content="Asciidoctor 0.1.4"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>OpenShift 3 Disconnected Installation Solution Lab</title><style>@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333333; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: Arial, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Arial, sans-serif; font-weight: normal; font-style: normal; color: #7b2d00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: Arial, sans-serif; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }

blockquote, blockquote p { line-height: 1.6; color: #333333; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
/* Change -webkit-linear-gradient colors to  #a70000 and remove gradient */
table thead, table tfoot { background: -webkit-linear-gradient(top, #a70000, #a70000); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: white; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; padding: 3px 2px 1px 2px; white-space: nowrap; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }

pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

kbd.keyseq { color: #333333; }

kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

kbd kbd:first-child { margin-left: 0; }

kbd kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before { content: '[ '; }

b.button:after { content: ' ]'; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #7b2d00; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #333333; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }

#toctitle { color: #003b6b; }

@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; border-width: 0; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }

#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7b2d00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #333333; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #aaaaaa; box-shadow: 0 1px 8px #aaaaaa; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; line-height: 1.6; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre:not([class]), .listingblock pre:not([class]) { background: #eeeeee; }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px; border-style: dashed; border-color: #666666; -webkit-border-radius: 0; border-radius: 0; padding: 1.25em 1.5625em 1.125em 1.5625em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.9em; } }

.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 1.25em 1.5625em 1.125em 1.5625em; }

.listingblock > .content { position: relative; }

.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }

.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }

table.pyhltable { border: 0; margin-bottom: 0; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }

.quoteblock { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 0.75em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #e15200; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }

th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }

th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }

tbody tr th { display: table-cell; line-height: 1.4; background: -webkit-linear-gradient(top, #add386, #90b66a); }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: white; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .8em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.qanda > ol > li > p > em:only-child { color: #004985; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #00579e; color: #004176; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #dddddd; }

#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }

.sidebarblock { border-color: #aaa; }

code { -webkit-border-radius: 4px; border-radius: 4px; }

p.tableblock.header { color: #6d6e71; }</style><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/3.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/sunburst.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad()</script></head><body class="article toc2 toc-left"><div id="header"><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1">
<li><a href="#_openshift_3_disconnected_installation_solution_lab">OpenShift 3 Disconnected Installation Solution Lab</a></li>
<li><a href="#_provision_lab_environment">1. Provision Lab Environment</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_share_public_key_with_opentlc">1.1. Share Public Key with OPENTLC</a></li>
<li><a href="#_start_environment_after_shut_down">1.2. Start Environment After Shut Down</a></li>
<li><a href="#_test_server_connections">1.3. Test Server Connections</a></li>
<li><a href="#_prepare_guid_environment_variable_across_all_hosts">1.4. Prepare GUID environment variable across all hosts</a></li>
</ul>
</li>
<li><a href="#labexercises">2. Set Up Isolated Host: RPM Repository and Container Registry</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_verify_proxied_rpm_repository">2.1. Verify Proxied RPM Repository</a></li>
<li><a href="#_install_image_registry">2.2. Install Image Registry</a></li>
<li><a href="#_populate_image_registry">2.3. Populate Image Registry</a></li>
</ul>
</li>
<li><a href="#_install_openshift">3. Install OpenShift</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_prepare_openshift_cluster_hosts">3.1. Prepare OpenShift Cluster Hosts</a></li>
<li><a href="#_configure_ansible_inventory_file_for_disconnected_install">3.2. Configure Ansible Inventory File for Disconnected Install</a></li>
<li><a href="#_execute_openshift_installer">3.3. Execute OpenShift Installer</a></li>
<li><a href="#_uninstall_cluster">3.4. Uninstall Cluster</a></li>
<li><a href="#_configure_cluster_post_installation">3.5. Configure Cluster Post-Installation</a></li>
<li><a href="#_configure_load_balancer_to_service_routers">3.6. Configure Load Balancer to Service Routers</a></li>
</ul>
</li>
<li><a href="#_deploy_ci_cd_tools_and_build_s2i">4. Deploy CI/CD Tools and Build S2I</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_import_build_images_into_integrated_registry">4.1. Import Build Images into Integrated Registry</a></li>
<li><a href="#_deploy_nexus3">4.2. Deploy Nexus3</a></li>
<li><a href="#_prepare_repository_in_nexus">4.3. Prepare Repository in Nexus</a></li>
<li><a href="#_deploy_gogs">4.4. Deploy Gogs</a></li>
<li><a href="#_push_code_openshift_tasks_code_source_code_into_gogs">4.5. Push <code>openshift-tasks</code> Source Code into Gogs</a></li>
<li><a href="#_run_build_from_bastion">4.6. Run Build from Bastion</a></li>
</ul>
</li>
<li><a href="#_review_lab_accomplishments">5. Review Lab Accomplishments</a></li>
</ul></div></div><div id="content"><div class="sect1"><h2 id="_openshift_3_disconnected_installation_solution_lab">OpenShift 3 Disconnected Installation Solution Lab</h2><div class="sectionbody"><div class="paragraph"><div class="title">Overview</div><p>In a disconnected environment, the installer and applications have access to all of their services' required components without requiring access to the Internet.</p></div>
<div class="paragraph"><p>A disconnected install usually occurs in a private network environment dedicated to the cluster. Other networks dedicated to particular purposes access the private network in a highly specified, regulated, and audited manner. Typical networks in a highly secure architecture are likely to include separate networks for general operations, application access, cluster management, development, storage, and so on.</p></div>
<div class="paragraph"><div class="title">Lab Infrastructure</div><p>The lab infrastructure is a vastly simplified version of this, but it still approximates the installation and operational context of a true disconnected install.</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Hosts</caption><colgroup><col style="width:12%"><col style="width:12%"><col style="width:12%"><col style="width:12%"><col style="width:12%"><col style="width:12%"><col style="width:25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Host</th><th class="tableblock halign-left valign-top">Hostname</th><th class="tableblock halign-left valign-top">Count</th><th class="tableblock halign-left valign-top">Network</th><th class="tableblock halign-left valign-top">Ports Open to Internet</th><th class="tableblock halign-left valign-top">Service</th><th class="tableblock halign-left valign-top">Purpose</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Bastion</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>bastion.$GUID.example.opentlc.com</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Public</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>22</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Ansible</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Installation</p></li><li><p>Ops management command</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Isolated</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>isolated1.$GUID.internal</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Public</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>All</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>RPM repository (HTTP reverse proxy)</p></li><li><p>Isolated image registry</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Mimics laptop or file source for installation</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Load Balancer</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>loadbalancer.$GUID.example.opentlc.com</code>, <code>loadbalancer.$GUID.internal</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Private</p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>80</p></li><li><p>443</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>HAProxy</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>OpenShift master API high availability</p></li><li><p>Application access (disconnected only)</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Masters</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>master[1:3].$GUID.internal</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Private</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>OpenShift node</p></li><li><p>OpenShift master API and controllers</p></li><li><p><code>etcd</code> datastore</p></li><li><p><code>oc</code> command line tool</p></li><li><p>Logging and stats collection</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Cluster management</p></li><li><p>Test application deployment</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Nodes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>node[1:2].$GUID.internal</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Private</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>OpenShift node</p></li><li><p>Application pods/containers</p></li><li><p>Logging and stats collection</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Deployment targets for pods</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Infra Nodes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>infranode[1:2].internal</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Private</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>OpenShift node</p></li><li><p>OpenShift integrated registry</p></li><li><p>OpenShift router</p></li><li><p>Logging and stats collection</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Application access</p></li><li><p>Internal integrated image registry for application artifacts</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Support Node</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>support1.$GUID.internal</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Private</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>NFS</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><div><div class="ulist"><ul><li><p>Remote storage for OpenShift persistent volumes</p></li></ul></div></div></td></tr></tbody></table>
<div class="paragraph"><div class="title">Application domain</div><p>Your routers should be configured for the domain <code>apps.$GUID.example.opentlc.com</code>.</p></div>
<div class="paragraph"><div class="title">Networks</div><p>There are only two networks in this lab.</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:25%"><col style="width:25%"><col style="width:25%"><col style="width:25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Network</th><th class="tableblock halign-left valign-top">Hosts</th><th class="tableblock halign-left valign-top">Services</th><th class="tableblock halign-left valign-top">Purpose</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Private (ClusterLAN)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Load Balancer, Masters, Nodes, Storage</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift, NFS</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Private LAN for all OpenShift and storage traffic</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Public LAN (Ops, Dev, DMZ)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bastion, Isolated</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ansible</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Installations and ops management</p></td></tr></tbody></table>
<div class="ulist"><div class="title">Goals</div><ul><li><p>Set up an isolated host for the RPM repository and container registry</p></li><li><p>Install OpenShift Container Platform</p></li><li><p>Deploy CI/CD tools to build and deploy applications</p></li></ul></div></div></div>
<div class="sect1"><h2 id="_provision_lab_environment">1. Provision Lab Environment</h2><div class="sectionbody"><div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">If you previously set up an environment for this class, you can skip this section and go directly to the <a href="#labexercises">Set Up Isolated Host: RPM Repository and Container Registry</a> section.</td></tr></table></div>
<div class="paragraph"><p>In this section, you provision the lab environment to provide access to all of the components required to perform the labs. The lab environment is a shared cloud-based environment, so that you can access it over the Internet from anywhere. However, do not expect performance to match a dedicated environment.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Go to the <a href="https://labs.opentlc.com/" target="_blank">OPENTLC lab portal</a> and use your OPENTLC credentials to log in.</p><div class="admonitionblock tip"><table><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">If you do not remember your password, go to the <a href="https://www.opentlc.com/account/" target="_blank">OPENTLC Account Management page</a> to reset your password.</td></tr></table></div></li><li><p>Navigate to <strong>Services &#8594; Catalogs &#8594; All Services &#8594; OPENTLC OpenShift Labs</strong>.</p></li><li><p>On the left, select <strong>OpenShift Disconnected HA Lab</strong>.</p></li><li><p>On the right, click <strong>Order</strong>.</p></li><li><p>If you are not in North America, click <strong>Lab Parameters</strong> and select your appropriate region.</p></li><li><p>On the bottom right, click <strong>Submit</strong>.</p><div class="admonitionblock warning"><table><tr><td class="icon"><i class="icon-warning" title="Warning"></i></td><td class="content">Do not select <strong>App Control &#8594; Start</strong> after ordering the lab. Ordering the lab automatically begins the build process. Selecting <strong>Start</strong> may corrupt the lab environment or cause other complications.</td></tr></table></div>
<div class="ulist"><ul><li><p>After a few minutes, expect to receive an email with instructions on how to connect to the environment.</p></li></ul></div></li><li><p>You will receive three e-mails:</p><div class="listingblock"><div class="title">Provisioning started</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">Provisioning has started on your Red Hat OPENTLC OTLC-LAB-&lt;OPENTLC Username&gt;-PROD_OCP_HA_DISCONNECTED_LAB-&lt;GUID&gt; environment.
You will receive more information via email during the build process within the next 30 minutes.</code></pre></div></div>
<div class="listingblock"><div class="title">Provisioning has updated (this means that the VMs have been requested successfully)</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">Provisioning is continuing for Red Hat OPENTLC service OTLC-LAB-&lt;OPENTLC Username&gt;-PROD_OCP_HA_DISCONNECTED_LAB-&lt;GUID&gt;6.
You will receive another email when the environment is available within the next 30 minutes.</code></pre></div></div>
<div class="listingblock"><div class="title">Provisioning completed</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">Your environment for OTLC-LAB-&lt;OPENTLC Username&gt;-PROD_OCP_HA_DISCONNECTED_LAB-e176 has been provisioned.
Your unique identifier, GUID, is: e176

Access to the environment will be granted as soon as the environment deployment is complete.

Please refer to your lab instructions on next steps and how to access your environment.

If your lab/demo instructions indicate connecting with SSH, use your OPENTLC private key, and user name wkulhane-redhat.com.
Here is an example:

$ ssh -i ~/.ssh/your_private_key_name &lt;OPENTLC Username&gt;@bastion.e176.example.opentlc.com

Troubleshooting and Access issues:

If you need help setting up SSH client on your workstation, use http://www.opentlc.com/ssh.html.
If you did not share your public key with OPENTLC (For ssh connections) or if you need to reset your OPENTLC password (For Web Console access), you can use this link: https://account.opentlc.com/account/

NOTICE: Your environment will expire and be deleted in 7 day(s) at 2018-04-26 00:00:00 -0400 and will be idled down after 8 hour(s).

In order to conserve resources, we cannot archive or restore any data in this environment. All data will be lost upon expiration.</code></pre></div></div></li><li><p>Wait until you receive the final e-mail before trying to connect to your environment.</p></li><li><p>Note the GUID (a 4 character ID) of your environment.</p></li></ol></div>
<div class="sect2"><h3 id="_share_public_key_with_opentlc">1.1. Share Public Key with OPENTLC</h3><div class="paragraph"><p>To access any of your lab systems via SSH, you must use your personal OPENTLC SSO username and public SSH key.</p></div>
<div class="paragraph"><p>If you have not already done so, you must provide a public SSH key to the OPENTLC authentication system:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Go to the <a href="https://www.opentlc.com/account/" target="_blank">OPENTLC Account Management page</a>.</p></li><li><p>Click <strong>Update SSH Key</strong> and log in using your OPENTLC credentials.</p></li><li><p>Paste your public key in that location.</p><div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">For more information on generating SSH keys, see <a href="https://www.opentlc.com/ssh.html" target="_blank">Setting Up an SSH Key Pair</a>.</td></tr></table></div></li></ol></div></div>
<div class="sect2"><h3 id="_start_environment_after_shut_down">1.2. Start Environment After Shut Down</h3><div class="paragraph"><p>To conserve resources, the lab environment shuts down automatically after eight hours. In this section, you restart the lab environment for this course after it has shut down automatically.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Go to the <a href="https://labs.opentlc.com/" target="_blank">OPENTLC lab portal</a> and use your OPENTLC credentials to log in.</p></li><li><p>Navigate to <strong>Services &#8594; My Services</strong> (this should be the screen shown right after logging in).</p></li><li><p>In the list of your services, select your lab environment.</p></li><li><p>Select <strong>App Control &#8594; Start</strong> to start your lab environment.</p></li><li><p>Select <strong>Yes</strong> at the <strong>Are you sure?</strong> prompt.</p></li><li><p>On the bottom right, click <strong>Submit</strong>.</p></li></ol></div>
<div class="paragraph"><p>After a few minutes, expect to receive an email letting you know that the lab environment has been started.</p></div></div>
<div class="sect2"><h3 id="_test_server_connections">1.3. Test Server Connections</h3><div class="paragraph"><p>The <code>bastion</code> administration host serves as an access point into the environment and is not part of the OpenShift environment.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Connect to your administration host and make sure you can access each of your provisioned hosts:</p><div class="listingblock"><div class="content"><pre>ssh -i ~/.ssh/yourprivatekey.key opentlc-username@bastion.$GUID.example.opentlc.com</pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_prepare_guid_environment_variable_across_all_hosts">1.4. Prepare GUID environment variable across all hosts</h3><div class="paragraph"><p>To make running commands specific to your environment easier, run the following ansible command to create a GUID environment variables on all hosts in your cluster that are managed by ansible.</p></div>
<div class="ulist"><ul><li><p>All GUID env variable to <code>$HOME/.bashrc</code> by connecting to the <code>bastion</code> host and executing the ad-hoc ansible command:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh -i ~/.ssh/yourprivatekey.key opentlc-username@bastion.$GUID.example.opentlc.com
sudo -i
ansible localhost,all -m shell -a 'export GUID=`hostname | cut -d"." -f2`; echo "export GUID=$GUID" &gt;&gt; $HOME/.bashrc'</code></pre></div></div></li></ul></div></div></div></div>
<div class="sect1"><h2 id="labexercises">2. Set Up Isolated Host: RPM Repository and Container Registry</h2><div class="sectionbody"><div class="paragraph"><p>In this lab, you must set up the isolated host to serve the proper RPMs and OpenShift container images prior to launching the OpenShift installation. You set up a simple HTTP reverse proxy on the isolated host to serve up RPM packages, and a registry to serve the container images.</p></div>
<div class="paragraph"><p>This lab covers in detail how the container images must be preloaded into the registry. The RPM packages do not need to be preloaded.</p></div>
<div class="paragraph"><p>In this lab, you access all of your hosts through the <code>bastion</code> host. First, you examine the portion of your environment that is addressable by Ansible.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Use SSH to access the <code>bastion</code> host and switch to <code>root</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh bastion.$GUID.example.opentlc.com
sudo -i</code></pre></div></div></li><li><p>Examine the environment available to you via Ansible:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ansible all -m ping</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">master2.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
master1.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
infranode1.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
loadbalancer.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
master3.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
infranode2.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
support1.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
node1.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}
node2.GUID.internal | SUCCESS =&gt; {
    "changed": false,
    "failed": false,
    "ping": "pong"
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">Your <code>isolated1</code> node does not appear here&#8212;it is not managed by Ansible.</td></tr></table></div></li><li><p>Use SSH to access the isolated host and switch to <code>root</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh isolated1.$GUID.internal
sudo -i</code></pre></div></div></li></ol></div>
<div class="sect2"><h3 id="_verify_proxied_rpm_repository">2.1. Verify Proxied RPM Repository</h3><div class="olist arabic"><ol class="arabic"><li><p>Examine the configuration file of the HTTP reverse proxy:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">cat /etc/httpd/conf.d/default.conf</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">&lt;VirtualHost *:*&gt;
    ProxyPreserveHost On

    ProxyPass / http://admin.na.shared.opentlc.com/
    ProxyPassReverse / http://admin.na.shared.opentlc.com/

    ServerName isolated1.$GUID.internal

    # parameterize me for more storage
    CacheRoot   "/var/cache/httpd/proxy/"
    CacheEnable disk /
    CacheDirLevels 2
    CacheDirLength 1

    CustomLog "/var/log/httpd/cached-requests.log" common env=cache-hit
    CustomLog "/var/log/httpd/uncached-requests.log" common env=cache-miss
    CustomLog "/var/log/httpd/revalidated-requests.log" common env=cache-revalidate
    CustomLog "/var/log/httpd/invalidated-requests.log" common env=cache-invalidate

&lt;/VirtualHost&gt;</code></pre></div></div></li><li><p>Note the following settings:</p><div class="ulist"><ul><li><p>It proxies the known good repository server</p></li><li><p>It caches non-aggressively&#8212;it does not override cache hints from upstream</p></li><li><p>It caches at <code>/var/cache/httpd/proxy/</code></p></li><li><p>It logs at <code>/var/log/httpd/</code></p></li></ul></div></li></ol></div></div>
<div class="sect2"><h3 id="_install_image_registry">2.2. Install Image Registry</h3><div class="olist arabic"><ol class="arabic"><li><p>Install the Docker image registry, <code>skopeo</code>, <code>jq</code>, and <code>podman</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">yum install -y docker-distribution skopeo podman
wget -O /usr/local/sbin/jq https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64
chmod +x /usr/local/sbin/jq</code></pre></div></div></li><li><p>Edit <code>/etc/docker-distribution/registry/config.yml</code> and replace the <code>rootdirectory</code> line:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">sed -i 's/^.*rootdirectory.*$/        rootdirectory: \/srv\/repohost\/registry/' /etc/docker-distribution/registry/config.yml</code></pre></div></div></li><li><p>Add the following lines to enable logging to <code>journalctl</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">cat &lt;&lt; EOF &gt;&gt; /etc/docker-distribution/registry/config.yml
log:
  accesslog:
    disabled: false
  level: info
  formatter: text
  fields:
    service: registry
    environment: staging
EOF</code></pre></div></div></li><li><p>Create the directory to hold images in the registry and use <code>systemd</code> to enable, start, and check the status of the Docker registry:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">mkdir -p /srv/repohost/registry
systemctl enable docker-distribution
systemctl start docker-distribution
systemctl status docker-distribution</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_populate_image_registry">2.3. Populate Image Registry</h3><div class="paragraph"><p>In this section, you copy all of the images from the Red Hat registry to the local Docker registry, and make sure that they are written to the local registry with tags that match the requirements of the current release of RHOCP. This can take quite some time.  These commands run concurrently in their own loops.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Log in to <code>registry.redhat.io</code> with your Customer Portal credentials so <code>skopeo</code> can copy images:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">podman login registry.redhat.io</code></pre></div></div></li><li><p>Run each of the following three steps in separate shells on the <code>isolated1</code> node:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Make sure the images already tagged as v3.11.59 keep v3.11.59 tags:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">LOCAL_TAG=v3.11.59

IMAGES_CORE="apb-base apb-tools automation-broker-apb csi-attacher csi-driver-registrar csi-livenessprobe csi-provisioner grafana image-inspector mariadb-apb mediawiki mediawiki-apb mysql-apb ose-ansible ose-ansible-service-broker ose-cli ose-cluster-autoscaler ose-cluster-capacity ose-cluster-monitoring-operator ose-console ose-configmap-reloader ose-control-plane ose-deployer ose-descheduler ose-docker-builder"

time for image in ${IMAGES_CORE}
do
  echo "Copying image: $image"
  skopeo copy --dest-tls-verify=false docker://registry.redhat.io/openshift3/${image}:${LOCAL_TAG} docker://localhost:5000/openshift3/${image}:${LOCAL_TAG}
  echo "Copied image: $image"
done</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">LOCAL_TAG=v3.11.59
IMAGES_CORE="ose-docker-registry ose-efs-provisioner ose-egress-dns-proxy ose-egress-http-proxy ose-egress-router ose-haproxy-router ose-hyperkube ose-hypershift ose-keepalived-ipfailover ose-kube-rbac-proxy ose-kube-state-metrics ose-metrics-server ose-node ose-node-problem-detector ose-operator-lifecycle-manager ose-pod ose-prometheus-config-reloader ose-prometheus-operator ose-recycler ose-service-catalog ose-template-service-broker ose-web-console postgresql-apb registry-console snapshot-controller snapshot-provisioner"

time for image in ${IMAGES_CORE}
do
  echo "Copying image: $image"
  skopeo copy --dest-tls-verify=false docker://registry.redhat.io/openshift3/${image}:${LOCAL_TAG} docker://localhost:5000/openshift3/${image}:${LOCAL_TAG}
  echo "Copied image: $image"
done</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">IMAGES_CRITICAL="rhel7/etcd:3.2.22"
time for image in ${IMAGES_CRITICAL}
do
  skopeo copy --dest-tls-verify=false docker://registry.redhat.io/${image} docker://localhost:5000/${image}
  echo "Copied image: $image"
done</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">LOCAL_TAG=v3.11.59
IMAGES_ADDITIONAL="metrics-cassandra metrics-hawkular-metrics metrics-hawkular-openshift-agent metrics-heapster oauth-proxy ose-logging-curator5 ose-logging-elasticsearch5 ose-logging-eventrouter ose-logging-fluentd ose-logging-kibana5 ose-metrics-schema-installer prometheus prometheus-alert-buffer prometheus-alertmanager prometheus-node-exporter metrics-schema-installer"

time for image in ${IMAGES_ADDITIONAL}
do
  echo "Copying image: $image"
  skopeo copy --dest-tls-verify=false docker://registry.redhat.io/openshift3/${image}:${LOCAL_TAG} docker://localhost:5000/openshift3/${image}:${LOCAL_TAG}
  echo "Copied image: $image"
done</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">The prometheus-alert-buffer image is not tagged for v3.11.59.  Use the following command:</td></tr></table></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash">skopeo copy --dest-tls-verify=false docker://registry.redhat.io/openshift3/prometheus-alert-buffer:latest docker://localhost:5000/openshift3/prometheus-alert-buffer:v3.11.59</code></pre></div></div></li><li><p>Pull the Red Hat-certified Source-to-Image (S2I) builder images that you intend to use in your OpenShift Container Platform environment:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">S2I_BUILDER_IMAGES="jboss-amq-6/amq63-openshift jboss-datagrid-7/datagrid71-openshift jboss-datagrid-7/datagrid71-client-openshift jboss-datavirt-6/datavirt63-openshift jboss-datavirt-6/datavirt63-driver-openshift jboss-decisionserver-6/decisionserver64-openshift jboss-processserver-6/processserver64-openshift jboss-eap-6/eap64-openshift jboss-eap-7/eap71-openshift jboss-eap-7/eap71-openshift jboss-webserver-3/webserver31-tomcat7-openshift jboss-webserver-3/webserver31-tomcat8-openshift openshift3/jenkins-2-rhel7 openshift3/jenkins-agent-maven-35-rhel7 openshift3/jenkins-agent-nodejs-8-rhel7"
time for image in ${S2I_BUILDER_IMAGES}
do
  echo "Copying image: $image"
  skopeo copy --dest-tls-verify=false docker://registry.redhat.io/${image} docker://localhost:5000/${image}
  echo "Copied image: $image"
done</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">S2I_BUILDER_IMAGES="openshift3/jenkins-slave-base-rhel7 openshift3/jenkins-slave-maven-rhel7 openshift3/jenkins-slave-nodejs-rhel7 rhscl/mongodb-32-rhel7 rhscl/mysql-57-rhel7 rhscl/perl-524-rhel7 rhscl/php-56-rhel7 rhscl/postgresql-95-rhel7 rhscl/python-35-rhel7 redhat-sso-7/sso70-openshift rhscl/ruby-24-rhel7 redhat-openjdk-18/openjdk18-openshift redhat-sso-7/sso71-openshift rhscl/nodejs-6-rhel7 rhscl/mariadb-101-rhel7"

time for image in ${S2I_BUILDER_IMAGES}
do
  echo "Copying image: $image"
  skopeo copy --dest-tls-verify=false docker://registry.redhat.io/${image} docker://localhost:5000/${image}
  echo "Copied image: $image"
done</code></pre></div></div></li><li><p>Copy the images for applications:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh"># Nexus and Gogs (latest) from docker.io
for image in sonatype/nexus3 wkulhanek/gogs
do
  skopeo copy --dest-tls-verify=false docker://docker.io/${image}:latest docker://localhost:5000/${image}:latest
done

# even more recent postgresql and jboss-eap to support nexus and gogs
for image in rhscl/postgresql-96-rhel7 jboss-eap-7/eap71-openshift
do
  skopeo copy --dest-tls-verify=false docker://registry.access.redhat.com/$image:latest docker://localhost:5000/${image}:latest
done</code></pre></div></div></li></ol></div></li><li><p>After all of the copies from the Internet to your isolated registry are complete, log out of the <code>isolated1</code> host and switch back to your <code>bastion</code> host:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">exit</code></pre></div></div></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_install_openshift">3. Install OpenShift</h2><div class="sectionbody"><div class="sect2"><h3 id="_prepare_openshift_cluster_hosts">3.1. Prepare OpenShift Cluster Hosts</h3><div class="paragraph"><p>You need to perform these tasks as <code>root</code> on <code>bastion.$GUID.internal</code>.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Make sure that all of your masters and nodes have Docker running:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ansible nodes -mshell -a'systemctl status docker| grep Active'</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">node2.$GUID.internal | SUCCESS | rc=0 &gt;&gt;
   Active: active (running) since Fri 2018-03-09 18:18:41 UTC; 3 days ago

master1.$GUID.internal | SUCCESS | rc=0 &gt;&gt;
   Active: active (running) since Fri 2018-03-09 18:18:39 UTC; 3 days ago

infranode1.$GUID.internal | SUCCESS | rc=0 &gt;&gt;
   Active: active (running) since Fri 2018-03-09 18:18:40 UTC; 3 days ago

node1.$GUID.internal | SUCCESS | rc=0 &gt;&gt;
   Active: active (running) since Fri 2018-03-09 18:18:40 UTC; 3 days ago

... output omitted ...
... output omitted ...
... output omitted ...</code></pre></div></div></li><li><p>Make sure that the yum repository configurations on all of the hosts in the deployment are pointing to the isolated host:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ansible all -mshell -a'yum repolist -v| grep baseurl'</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">[WARNING]: Consider using yum module rather than running yum


loadbalancer.$GUID.internal | SUCCESS | rc=0 &gt;&gt;
Repo-baseurl : http://isolated1.$GUID.internal/repos/ocp/3.11.59/rhel-7-server-ansible-2.6-rpms
Repo-baseurl : http://isolated1.$GUID.internal/repos/ocp/3.11.59/rhel-7-server-extras-rpms
Repo-baseurl : http://isolated1.$GUID.internal/repos/ocp/3.11.59/rhel-7-server-optional-rpms
Repo-baseurl : http://isolated1.$GUID.internal/repos/ocp/3.11.59/rhel-7-server-ose-3.11-rpms
Repo-baseurl : http://isolated1.$GUID.internal/repos/ocp/3.11.59/rhel-7-server-rh-common-rpms
Repo-baseurl : http://isolated1.$GUID.internal/repos/ocp/3.11.59/rhel-7-server-rpms

... omitted output ...
... omitted output ...
... omitted output ...</code></pre></div></div></li><li><p>From the <code>bastion</code> host, connect to the support server to create additional NFS exports to support applications:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh support1.$GUID.internal
sudo -i
mkdir -p /srv/nfs/user-vols/pv{1..200}

for pvnum in {1..50} ; do
echo /srv/nfs/user-vols/pv${pvnum} *(rw,root_squash) &gt;&gt; /etc/exports.d/openshift-uservols.exports
chown -R nfsnobody.nfsnobody  /srv/nfs
chmod -R 777 /srv/nfs
done

systemctl restart nfs-server
exit
exit</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_configure_ansible_inventory_file_for_disconnected_install">3.2. Configure Ansible Inventory File for Disconnected Install</h3><div class="olist arabic"><ol class="arabic"><li><p>On the <code>bastion</code> host, edit your <code>/etc/ansible/hosts</code> Ansible inventory file to address the following requirements:</p><div class="ulist"><ul><li><p>Deploy a three-master HA OpenShift deployment with a load balancer for API and web console load balancing.</p></li><li><p>Make sure the load balancer listens on port 443 (and not 8443).</p></li><li><p>Set two nodes to be infra nodes and set the proper node-groups on them.</p></li><li><p>Deploy OpenShift routers with wildcard domains on both of the infra nodes.</p></li><li><p>Deploy an integrated OpenShift image registry on your infra nodes.</p></li><li><p>Deploy Fluentd logging and Hawkular metrics with persistent storage for all nodes in the cluster.</p></li><li><p>Deploy Prometheus-based metrics and alerting.</p></li><li><p>Deploy the template service broker and service catalog.</p></li><li><p>Deploy the OpenShift Ansible Broker.</p></li><li><p>Set up HTTP authorization via an <code>.htaccess</code> file.</p><div class="ulist"><ul><li><p>See the sample file on your <code>bastion</code> host at <code>/root/htpasswd.openshift</code>.</p></li></ul></div></li><li><p>Set up <code>ovs-networkpolicy</code> as your SDN plug-in.</p></li></ul></div></li><li><p>Finally, and most importantly, configure RHOCP to access the isolated registry and repository,
and not the default:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">vi /etc/ansible/hosts</code></pre></div></div>
<div class="admonitionblock tip"><table><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">A fully populated and working solution is available on your <code>bastion</code> host in <code>/var/preserve/hosts</code>.</td></tr></table></div></li></ol></div></div>
<div class="sect2"><h3 id="_execute_openshift_installer">3.3. Execute OpenShift Installer</h3><div class="paragraph"><p>In this section, you execute the OpenShift installer and monitor the installation process.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Run the prerequisites playbook:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">cd /usr/share/ansible/openshift-ansible/
ansible-playbook playbooks/prerequisites.yml</code></pre></div></div></li><li><p>Run the installation playbook:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ansible-playbook playbooks/deploy_cluster.yml</code></pre></div></div></li><li><p>On your isolated host, use <code>tmux</code> to create two windows and then view the logs of your registry and HTTP reverse proxy as follows:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>View HTTP reverse proxy logs showing RPM repository access:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh isolated1.$GUID.internal
sudo -i
tail -f /var/log/httpd/*</code></pre></div></div>
<div class="ulist"><ul><li><p>You can observe which packages your <code>httpd-reverse-proxy-cache</code> was able to cache.</p></li></ul></div></li><li><p>After about 15 minutes, observe the image pulls from the server side by examining the <code>systemd</code> journal:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh master1.$GUID.internal
sudo -i
journalctl -fu atomic-openshift-node | grep -i pull</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">2018-03-13 18:05:47 +0000 UTC   2018-03-13 18:05:47 +0000 UTC   1         docker-registry-1-fppsj   Pod       spec.containers{registry}   Normal    Pulling   kubelet, infranode1.$GUID.internal   pulling image "isolated1.$GUID.internal:5000/openshift3/ose-docker-registry:v3.9.14"
2018-03-13 18:05:49 +0000 UTC   2018-03-13 18:05:49 +0000 UTC   1         docker-registry-1-fppsj   Pod       spec.containers{registry}   Normal    Pulled    kubelet, infranode1.$GUID.internal   Successfully pulled image "isolated1.$GUID.internal:5000/openshift3/ose-docker-registry:v3.9.14"</code></pre></div></div></li></ol></div></li><li><p>Observe OpenShift&#8217;s event logging:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh master1.$GUID.internal
sudo -i
oc get events --all-namespaces -w</code></pre></div></div>
<div class="ulist"><ul><li><p>After about 15 minutes, you can observe how OpenShift pulls the images it needs from the <code>isolated1.$GUID.internal</code> host.</p></li></ul></div></li><li><p>Allow the Ansible playbooks to run to completion. The entire process takes about 20 minutes. In the end, expect to see output similar to the following:</p><div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">PLAY RECAP *************************************************************************************************************************************************************
infranode1.$GUID.internal   : ok=192  changed=60   unreachable=0    failed=0
infranode2.$GUID.internal   : ok=192  changed=60   unreachable=0    failed=0
loadbalancer.$GUID.internal : ok=73   changed=15   unreachable=0    failed=0
localhost                  : ok=14   changed=0    unreachable=0    failed=0
master1.$GUID.internal      : ok=1019 changed=397  unreachable=0    failed=0
master2.$GUID.internal      : ok=422  changed=151  unreachable=0    failed=0
master3.$GUID.internal      : ok=422  changed=152  unreachable=0    failed=0
node1.$GUID.internal        : ok=192  changed=60   unreachable=0    failed=0
node2.$GUID.internal        : ok=192  changed=60   unreachable=0    failed=0
support1.$GUID.internal     : ok=71   changed=13   unreachable=0    failed=0

INSTALLER STATUS *******************************************************************************************************************************************************
Initialization             : Complete
Health Check               : Complete
etcd Install               : Complete
NFS Install                : Complete
Load balancer Install      : Complete
Master Install             : Complete
Master Additional Install  : Complete
Node Install               : Complete
Hosted Install             : Complete
Metrics Install            : Complete
Logging Install            : Complete
Prometheus Install         : Complete
Service Catalog Install    : Complete</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_uninstall_cluster">3.4. Uninstall Cluster</h3><div class="admonitionblock warning"><table><tr><td class="icon"><i class="icon-warning" title="Warning"></i></td><td class="content">The following will uninstall your OpenShift Cluster, potentially wasting hours of time.</td></tr></table></div>
<div class="paragraph"><p>If you have made an error in hostnames, or another error that cannot be fixed by re-running <code>prerequisites.yaml</code> and <code>deploy-cluster.yaml</code> then uninstall OpenShift and re-install.  Don&#8217;t forget to remove configuration files, certificates, and remote storage data that your hosted components created (NFS).</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Run Uninstall Playbooks on the <code>bastion</code></p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text">cd /usr/share/ansible/openshift-ansible
ansible-playbook playbooks/adhoc/uninstall.yml</code></pre></div></div></li><li><p>Delete the /etc/origin directories on all nodes to clean up left over configuration files, certificates, etc.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text">ansible nodes -m shell -a "rm -rf /etc/origin"</code></pre></div></div></li><li><p>Make sure to clean out any NFS Directories for Metrics/Logging/Registry if they had data in them</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text">ansible nfs -m shell -a 'rm -rf /srv/nfs/*'</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_configure_cluster_post_installation">3.5. Configure Cluster Post-Installation</h3><div class="paragraph"><p>Use the <code>bastion</code> host to execute all of these tasks.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>As <code>root</code>, fetch the <code>.kube</code> directory from one of the masters to your <code>bastion</code> host:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ansible masters[0] -b -m fetch -a "src=/root/.kube/config dest=/root/.kube/config flat=yes"</code></pre></div></div>
<div class="ulist"><ul><li><p>This enables you to use <code>oc</code> commands as <code>system:admin</code>.</p></li></ul></div></li><li><p>Give user <code>marina</code> the role <code>cluster-admin</code> so you can log in with her user later.</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text">oc adm policy add-cluster-role-to-user cluster-admin marina</code></pre></div></div></li><li><p>Create PVs backed by NFS volumes:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">export GUID=$(hostname | cut -d'.' -f2)
mkdir /root/pvs

# create RWO PVs
for volume in pv{1..100} ; do
cat &lt;&lt; EOF &gt; /root/pvs/${volume}
{
  "apiVersion": "v1",
  "kind": "PersistentVolume",
  "metadata": {
    "name": "${volume}"
  },
  "spec": {
    "capacity": {
        "storage": "10Gi"
    },
    "accessModes": [ "ReadWriteOnce" ],
    "nfs": {
        "path": "/srv/nfs/user-vols/${volume}",
        "server": "support1.$GUID.internal"
    },
    "persistentVolumeReclaimPolicy": "Recycle"
  }
}
EOF
echo "Created def file for ${volume}";
done;

# create RWX PVs
for volume in pv{101..200} ; do
cat &lt;&lt; EOF &gt; /root/pvs/${volume}
{
  "apiVersion": "v1",
  "kind": "PersistentVolume",
  "metadata": {
    "name": "${volume}"
  },
  "spec": {
    "capacity": {
        "storage": "10Gi"
    },
    "accessModes": [ "ReadWriteMany" ],
    "nfs": {
        "path": "/srv/nfs/user-vols/${volume}",
        "server": "support1.$GUID.internal"
    },
    "persistentVolumeReclaimPolicy": "Recycle"
  }
}
EOF
echo "Created def file for ${volume}";
done;

cat /root/pvs/* | oc create -f -</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_configure_load_balancer_to_service_routers">3.6. Configure Load Balancer to Service Routers</h3><div class="paragraph"><p>In this section, you configure <code>loadbalancer</code> to also serve the <code>*.apps</code> wildcard domain.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>From the <code>bastion</code> host, connect to <code>loadbalancer</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">ssh loadbalancer.$GUID.internal
sudo -i</code></pre></div></div></li><li><p>Open port 80 on <code>loadbalancer</code>:</p><div class="admonitionblock tip"><table><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content"><div class="paragraph"><p>You are likely not running <code>firewalld</code>. In that case, use <code>iptables</code> to open port 80 to the HAProxy running on the load balancer.</p></div></td></tr></table></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">// not running firewalld
iptables -A OS_FIREWALL_ALLOW -p tcp -m tcp --dport 80 -j ACCEPT
service iptables save

// If you are running firewalld
firewall-cmd --permanent --add-service=http
firewall-cmd --reload</code></pre></div></div></li><li><p>Add entries in <code>/etc/haproxy/haproxy.cfg</code> to configure HAProxy to forward to your infra nodes:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">export GUID=`hostname | awk -F. '{print $2}'`
MASTER1=`host master1.$GUID.internal | cut -f4 -d" "`
MASTER2=`host master2.$GUID.internal | cut -f4 -d" "`
MASTER3=`host master3.$GUID.internal | cut -f4 -d" "`
INFRANODE1=`host infranode1.$GUID.internal | cut -f4 -d" "`
INFRANODE2=`host infranode2.$GUID.internal | cut -f4 -d" "`
cat &lt;&lt;EOF &gt; /etc/haproxy/haproxy.cfg

# Global settings
#---------------------------------------------------------------------
global
    maxconn     20000
    log         /dev/log local0 info
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    user        haproxy
    group       haproxy
    daemon

    # turn on stats unix socket
    stats socket /var/lib/haproxy/stats

#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
#    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          300s
    timeout server          300s
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 20000

listen stats :9000
    mode http
    stats enable
    stats uri /

frontend  atomic-openshift-all-the-things-http
    bind  *:80
    mode tcp
    option tcplog
    default_backend atomic-openshift-apps-http

frontend  atomic-openshift-all-the-things-https
    bind  *:443
    mode tcp
    option tcplog
    tcp-request inspect-delay 5s
    tcp-request content accept if { req_ssl_hello_type 1 }

    acl host_masters   req_ssl_sni -i loadbalancer.${GUID}.example.opentlc.com loadbalancer.${GUID}.internal
    use_backend atomic-openshift-api if host_masters
    default_backend atomic-openshift-apps-https

frontend  atomic-openshift-all-the-things-http
    bind  *:80
    mode tcp
    option tcplog
    default_backend atomic-openshift-apps-http

backend atomic-openshift-api
    balance source
    mode tcp
    server      master0 $MASTER1:443 check
    server      master1 $MASTER2:443 check
    server      master2 $MASTER3:443 check

backend atomic-openshift-apps-https
    balance source
    mode tcp
    server      infranode1 $INFRANODE1:443 check
    server      infranode2 $INFRANODE2:443 check

backend atomic-openshift-apps-http
    balance source
    mode tcp
    server      infranode1 $INFRANODE1:80 check
    server      infranode2 $INFRANODE2:80 check
EOF</code></pre></div></div></li><li><p>Restart the HAProxy service and verify that ports 80 and 443 are open:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">systemctl restart haproxy ; systemctl status haproxy
ss -lntp</code></pre></div></div></li><li><p>Disconnect from the <code>loadbalancer</code> host.</p></li><li><p>Test that your configuration worked by going to your OpenShift web console and log in.</p><div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content">Log in as <code>marina</code>.  Ask your instructor for the password.</td></tr></table></div></li><li><p>Then test that Hawkular is accessible by going to
<code>https://hawkular-metrics.apps.GUID.example.opentlc.com/hawkular/metrics</code>.</p></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_deploy_ci_cd_tools_and_build_s2i">4. Deploy CI/CD Tools and Build S2I</h2><div class="sectionbody"><div class="paragraph"><p>In this section, you deploy CI/CD tools to build and deploy applications.</p></div>
<div class="ulist"><ul><li><p>Gogs is a source code repository manager with a web front end.</p></li><li><p>Nexus is an artifact repository that stores build dependencies (among other capabilities).</p></li></ul></div>
<div class="paragraph"><p>Because your cluster has no outside connectivity&#8212;for example, to GitHub or the Maven repositories&#8212;you launch these tools in your disconnected private cluster network, and use them to supply the source code and dependent packages for your application builds.</p></div>
<div class="sect2"><h3 id="_import_build_images_into_integrated_registry">4.1. Import Build Images into Integrated Registry</h3><div class="olist arabic"><ol class="arabic"><li><p>Import all of the images that may be necessary&#8212;such as PostgreSQL, Gogs, and Nexus3&#8212;from the <code>isolated1.$GUID.internal</code> host to the OpenShift integrated <code>docker-registry</code> service that is running pods on your infra nodes:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh"># gogs container image was pulled into the isolated registry with skopeo.  Now import that image into your integrated registry with oc tools.
oc import-image docker-registry.default.svc:5000/gogs:latest --from=isolated1.$GUID.internal:5000/wkulhanek/gogs:latest --confirm --insecure=true -n openshift

# nexus was pulled into the isolated registry with skopeo.  Now import that image into your integrated registry with oc tools so you can deploy it soon.
oc import-image docker-registry.default.svc:5000/sonatype/nexus3:latest --from=isolated1.$GUID.internal:5000/sonatype/nexus3:latest --confirm --insecure=true -n openshift

# gogs will require a postgresql database.  Import it from the isolated registry into the integrated registry, so we can deploy it soon.
# delete the postgresql image stream first
oc delete is postgresql -n openshift
oc import-image docker-registry.default.svc:5000/rhscl/postgresql:9.6 --from=isolated1.$GUID.internal:5000/rhscl/postgresql-96-rhel7:latest --confirm --insecure=true -n openshift
# tag the postgresql as the lastest available
oc tag postgresql:9.6 postgresql:latest -n openshift</code></pre></div></div></li><li><p>Delete <code>jboss-eap</code> from the isolated registry and import it into the integrated registry to allow S2I to build the tasks application:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">oc delete is jboss-eap71-openshift -n openshift
oc import-image docker-registry.default.svc:5000/openshift/jboss-eap71-openshift:1.3 --from=isolated1.$GUID.internal:5000/jboss-eap-7/eap71-openshift --confirm --insecure=true -n openshift</code></pre></div></div>
<div class="ulist"><ul><li><p>Note the convenient host names for internal OpenShift services, like <code>docker-registry.default.svc</code>.</p></li><li><p>Also note that some images need tags other than <code>latest</code> because the templates are looking for specific tags.</p></li></ul></div></li></ol></div></div>
<div class="sect2"><h3 id="_deploy_nexus3">4.2. Deploy Nexus3</h3><div class="olist arabic"><ol class="arabic"><li><p>Deploy Nexus3 in OpenShift in a new <code>cicd</code> project:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">oc new-project cicd
echo "apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: nexus-pvc
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi" | oc create -f -
oc new-app openshift/nexus3:latest
oc rollout pause dc nexus3
oc patch dc nexus3 --patch='{ "spec": { "strategy": { "type": "Recreate" }}}'
oc set resources dc nexus3 --limits=memory=2Gi --requests=memory=1Gi

oc set volume dc/nexus3 --add --overwrite --name=nexus3-volume-1 --mount-path=/nexus-data/ --type persistentVolumeClaim --claim-name=nexus-pvc
oc set probe dc/nexus3 --liveness --failure-threshold 3 --initial-delay-seconds 60 -- echo ok
oc set probe dc/nexus3 --readiness --failure-threshold 3 --initial-delay-seconds 60 --get-url=http://:8081/repository/maven-public/
oc rollout resume dc nexus3
oc expose svc nexus3</code></pre></div></div></li></ol></div></div>
<div class="sect2"><h3 id="_prepare_repository_in_nexus">4.3. Prepare Repository in Nexus</h3><div class="paragraph"><p>In this section, you prepare a repository in Nexus for build artifacts using the web console.</p></div>
<div class="paragraph"><p>This is a fully offline environment, so Nexus cannot act as a proxy repository for an Internet-based repository. Therefore it is necessary to create a hosted Maven2 repository and copy all of the artifacts necessary for building any given application into the repository. All of the necessary artifacts are already made available for you in a zip file.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Log in to Nexus from your laptop at <code>http://nexus3-cicd.apps.$GUID.example.opentlc.com</code> with the username <code>admin</code> and password <code>admin123</code>.</p></li><li><p>In Nexus, create a hosted Maven2 repository called <code>offline</code>:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Click the gear icon and select <strong>Repositories &#8594; Create Repositories &#8594; maven2 (hosted)</strong>.</p></li><li><p>Name it <code>offline</code> and click <strong>Create Repository</strong>.</p></li></ol></div></li><li><p>Download the dependencies zip file and extract it to your <code>$HOME/repository</code> directory:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">cd $HOME
wget http://admin.na.shared.opentlc.com/openshift-tasks-7.1-repository.zip
unzip -o openshift-tasks-7.1-repository.zip -d $HOME</code></pre></div></div>
<div class="ulist"><ul><li><p>This ensures that all of the dependencies are in your Maven repository.</p></li></ul></div></li><li><p>Create the following <code>nexusimport.sh</code> script in <code>$HOME/repository</code>:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">cd $HOME/repository
cat &lt;&lt; EOF &gt; ./nexusimport.sh
#!/bin/bash

# copy and run this script to the root of the repository directory containing files
# this script attempts to exclude uploading itself explicitly so the script name is important
# Get command line params
while getopts ":r:u:p:" opt; do
  case \$opt in
    r) REPO_URL="\$OPTARG"
    ;;
    u) USERNAME="\$OPTARG"
    ;;
    p) PASSWORD="\$OPTARG"
    ;;
  esac
done

find . -type f \\
 -not -path './mavenimport\.sh*' \\
 -not -path '*/\.*' \\
 -not -path '*/\^archetype\-catalog\.xml*' \\
 -not -path '*/\^maven\-metadata\-local*\.xml' \\
 -not -path '*/\^maven\-metadata\-deployment*\.xml' | \\
 sed "s|^\./||" | \\
 xargs -t -I '{}' curl -s -S -u "\$USERNAME:\$PASSWORD" -X PUT -T {} \${REPO_URL}/{} ;
EOF</code></pre></div></div>
<div class="ulist"><ul><li><p>This simplifies loading dependencies into Nexus.</p></li></ul></div></li><li><p>Make sure the script is executable:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">chmod +x $HOME/repository/nexusimport.sh</code></pre></div></div></li><li><p>Now run the <code>nexusimport.sh</code> script to upload the entire repository into Nexus:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">cd $HOME/repository
./nexusimport.sh -u admin -p admin123 -r http://$(oc get route nexus3 --template='{{ .spec.host }}' -n cicd)/repository/offline/</code></pre></div></div>
<div class="ulist"><ul><li><p>This can take a minute or two.</p></li></ul></div></li></ol></div></div>
<div class="sect2"><h3 id="_deploy_gogs">4.4. Deploy Gogs</h3><div class="olist arabic"><ol class="arabic"><li><p>Create a PostgreSQL database for Gogs:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">oc project cicd
oc new-app postgresql-persistent --param POSTGRESQL_DATABASE=gogs --param POSTGRESQL_USER=gogs --param POSTGRESQL_PASSWORD=gogs --param VOLUME_CAPACITY=4Gi -lapp=postgresql_gogs</code></pre></div></div></li><li><p>Make sure to wait until <code>postgresql-persistent</code> is running, then create a Gogs template file called <code>$HOME/gogs.yaml</code> with the following content:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">echo 'kind: Template
apiVersion: v1
metadata:
  annotations:
    description: The Gogs git server. Requires a PostgreSQL database.
    tags: instant-app,gogs,datastore
    iconClass: icon-github
  name: gogs
objects:
- kind: Service
  apiVersion: v1
  metadata:
    annotations:
      description: The Gogs servers http port
    labels:
      app: ${APPLICATION_NAME}
    name: ${APPLICATION_NAME}
  spec:
    ports:
    - name: 3000-tcp
      port: 3000
      protocol: TCP
      targetPort: 3000
    selector:
      app: ${APPLICATION_NAME}
      deploymentconfig: ${APPLICATION_NAME}
    sessionAffinity: None
    type: ClusterIP
- kind: Route
  apiVersion: v1
  id: ${APPLICATION_NAME}-http
  metadata:
    annotations:
      description: Route for applications http service.
    labels:
      app: ${APPLICATION_NAME}
    name: ${APPLICATION_NAME}
  spec:
    host: ${GOGS_ROUTE}
    to:
      name: ${APPLICATION_NAME}
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    labels:
      app: ${APPLICATION_NAME}
    name: ${APPLICATION_NAME}
  spec:
    replicas: 1
    selector:
      app: ${APPLICATION_NAME}
      deploymentconfig: ${APPLICATION_NAME}
    strategy:
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        labels:
          app: ${APPLICATION_NAME}
          deploymentconfig: ${APPLICATION_NAME}
      spec:
        containers:
        - image: \"\"
          imagePullPolicy: Always
          name: ${APPLICATION_NAME}
          ports:
          - containerPort: 3000
            protocol: TCP
          resources: {}
          terminationMessagePath: /dev/termination-log
          volumeMounts:
          - name: gogs-data
            mountPath: /data
          - name: gogs-config
            mountPath: /opt/gogs/custom/conf
          readinessProbe:
              httpGet:
                path: /
                port: 3000
                scheme: HTTP
              initialDelaySeconds: 3
              timeoutSeconds: 1
              periodSeconds: 20
              successThreshold: 1
              failureThreshold: 3
          livenessProbe:
              httpGet:
                path: /
                port: 3000
                scheme: HTTP
              initialDelaySeconds: 3
              timeoutSeconds: 1
              periodSeconds: 10
              successThreshold: 1
              failureThreshold: 3
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        terminationGracePeriodSeconds: 30
        volumes:
        - name: gogs-data
          persistentVolumeClaim:
            claimName: gogs-data
        - name: gogs-config
          configMap:
            name: gogs-config
            items:
              - key: app.ini
                path: app.ini
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - ${APPLICATION_NAME}
        from:
          kind: ImageStreamTag
          name: ${GOGS_IMAGE}
          namespace: openshift
      type: ImageChange
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: gogs-data
  spec:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: ${GOGS_VOLUME_CAPACITY}
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: gogs-config
  data:
    app.ini: |
      APP_NAME = Gogs
      RUN_MODE = prod
      RUN_USER = gogs

      [database]
      DB_TYPE  = postgres
      HOST     = postgresql:5432
      NAME     = ${DATABASE_NAME}
      USER     = ${DATABASE_USER}
      PASSWD   = ${DATABASE_PASSWORD}
      SSL_MODE = disable

      [repository]
      ROOT = /data/repositories

      [server]
      ROOT_URL=http://${GOGS_ROUTE}

      [security]
      INSTALL_LOCK = true

      [mailer]
      ENABLED = false

      [service]
      ENABLE_CAPTCHA = false
      REGISTER_EMAIL_CONFIRM = false
      ENABLE_NOTIFY_MAIL     = false
      DISABLE_REGISTRATION   = false
      REQUIRE_SIGNIN_VIEW    = false

      [picture]
      DISABLE_GRAVATAR        = false
      ENABLE_FEDERATED_AVATAR = true

      [webhook]
      SKIP_TLS_VERIFY = true
parameters:
- name: APPLICATION_NAME
  description: The name for the application.
  required: true
  value: gogs
- name: GOGS_ROUTE
  description: The route for the Gogs Application
  required: true
- name: GOGS_VOLUME_CAPACITY
  description: Volume space available for data, e.g. 512Mi, 2Gi
  required: true
  value: 4Gi
- name: DATABASE_USER
  displayName: Database Username
  required: true
  value: gogs
- name: DATABASE_PASSWORD
  displayName: Database Password
  required: true
  value: gogs
- name: DATABASE_NAME
  displayName: Database Name
  required: true
  value: gogs
- name: GOGS_IMAGE
  displayName: Gogs Image and tag
  required: true
  value: gogs:latest' &gt; $HOME/gogs.yaml</code></pre></div></div></li><li><p>Create Gogs from the template:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">oc process -f $HOME/gogs.yaml --param GOGS_ROUTE=gogs-cicd.apps.$GUID.example.opentlc.com|oc create -f -</code></pre></div></div></li><li><p>Watch <code>oc get pods</code> within the <code>cicd</code> project until the deployment finishes.</p></li><li><p>When Gogs is running, navigate to the Gogs home page in your browser.</p><div class="admonitionblock tip"><table><tr><td class="icon"><i class="icon-tip" title="Tip"></i></td><td class="content">If you are not sure of the URL, you can determine the route using <code>oc get route -n cicd</code>.</td></tr></table></div></li><li><p>Register yourself as a new user.</p></li><li><p>Log in to Gogs as the user you just registered as.</p></li><li><p>Once logged in, create an organization named <code>CICDLabs</code>.</p></li><li><p>Under the <code>CICDLabs</code> organization, create a repository called <code>openshift-tasks</code>.</p><div class="admonitionblock important"><table><tr><td class="icon"><i class="icon-important" title="Important"></i></td><td class="content">Do not change the visibility setting. This repository must be <code>Public</code>.</td></tr></table></div></li></ol></div>
<div class="paragraph"><p>You have now created an empty source code repository in Gogs that OpenShift has access to. Next, you push code into this repository and build from that code and the dependencies that are in Nexus.</p></div></div>
<div class="sect2"><h3 id="_push_code_openshift_tasks_code_source_code_into_gogs">4.5. Push <code>openshift-tasks</code> Source Code into Gogs</h3><div class="olist arabic"><ol class="arabic"><li><p>Clone the <code>openshift-tasks</code> repository from GitHub and push it into the Gogs repository:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">cd $HOME
git clone https://github.com/redhat-gpte-devopsautomation/openshift-tasks.git
cd $HOME/openshift-tasks</code></pre></div></div></li><li><p>Set up the remote Git repository location in your local Git repository, and push it to Gogs by executing the following:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">git remote add gogs http://gogs-cicd.apps.$GUID.example.opentlc.com/CICDLabs/openshift-tasks.git
git push -u gogs master</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p><code>git</code> prompts you for your Gogs username and password when you execute the <code>push</code> command&#8212;make sure to use the username and password that you registered in Gogs.</p></div></td></tr></table></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight"><code class="texinfo language-texinfo">Counting objects: 314, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (209/209), done.
Username for 'http://gogs-cicd.apps.$GUID.example.opentlc.com': wkulhanek
Password for 'http://wkulhanek@gogs-cicd.apps.$GUID.example.opentlc.com':
Writing objects: 100% (314/314), 3.88 MiB | 305.00 KiB/s, done.
Total 314 (delta 69), reused 313 (delta 69)
To http://gogs-cicd.apps.$GUID.example.opentlc.com/CICDLabs/openshift-tasks.git
 * [new branch]      master -&gt; master
Branch master set up to track remote branch master from gogs.</code></pre></div></div>
<div class="ulist"><ul><li><p>This concludes the setup portion:</p><div class="ulist"><ul><li><p>The correct image stream for the builder image (EAP 7.1) is in your disconnected environment.</p></li><li><p>The image is available in the disconnected registry.</p></li><li><p>The source code is in the disconnected Gogs repository.</p></li><li><p>All of the Maven build dependencies are in Nexus.</p></li></ul></div></li></ul></div></li></ol></div></div>
<div class="sect2"><h3 id="_run_build_from_bastion">4.6. Run Build from Bastion</h3><div class="paragraph"><p>Now that all of the prerequisites are set up, it is time to execute a fully disconnected build. You are using the <code>eap71-basic-s2i</code> template to create the <code>openshift-tasks</code> application.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>On your <code>bastion</code> host as <code>root</code>, create the <code>tasks</code> project and then the application:</p><div class="admonitionblock note"><table><tr><td class="icon"><i class="icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p>You are specifying the Nexus proxy repository as a parameter to the builder image. Every Red Hat xPaaS builder image understands the <code>MAVEN_MIRROR_URL</code> variable. Furthermore, because the template has a few non-sensible defaults for the branch and context directory, you need to explicitly set the branch to <code>master</code> and the context directory to empty.</p></div></td></tr></table></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">oc new-project tasks
oc new-app eap71-basic-s2i \
--param MAVEN_MIRROR_URL=http://nexus3.cicd.svc.cluster.local:8081/repository/offline \
--param SOURCE_REPOSITORY_URL=http://gogs.cicd.svc.cluster.local:3000/CICDLabs/openshift-tasks \
--param SOURCE_REPOSITORY_REF=master \
--param CONTEXT_DIR= --param APPLICATION_NAME=tasks</code></pre></div></div>
<div class="ulist"><ul><li><p>If you did everything correctly, this application builds and then runs.</p></li></ul></div></li><li><p>Follow the build to make sure it is working properly, that the source code can be cloned, and that the build dependencies can be pulled from Nexus:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">oc logs -f tasks-1-build</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight nowrap"><code class="texinfo language-texinfo">Pulling image "isolated1.2a77.internal:5000/jboss-eap-7/eap70-openshift@sha256:9b99d822f4cbcb1d133dfbe1494d018a88a314385622b248265fd5b05719a27e" ...
Found pom.xml... attempting to build with 'mvn -e -Popenshift -DskipTests -Dcom.redhat.xpaas.repo.redhatga package --batch-mode -Djava.net.preferIPv4Stack=true '
Using MAVEN_OPTS '-XX:+UseParallelGC -XX:MinHeapFreeRatio=20 -XX:MaxHeapFreeRatio=40 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90 -XX:MaxMetaspaceSize=100m -XX:+ExitOnOutOfMemoryError'
Using Apache Maven 3.3.9 (Red Hat 3.3.9-2.8)
Maven home: /opt/rh/rh-maven33/root/usr/share/maven
Java version: 1.8.0_161, vendor: Oracle Corporation
Java home: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre
Default locale: en_US, platform encoding: ANSI_X3.4-1968
OS name: "linux", version: "3.10.0-693.el7.x86_64", arch: "amd64", family: "unix"
[INFO] Error stacktraces are turned on.
[INFO] Scanning for projects...
[INFO] Downloading: http://nexus3.cicd.svc.cluster.local:8081/repository/offline/org/jboss/bom/eap/jboss-javaee-6.0-with-tools/6.4.0.GA/jboss-javaee-6.0-with-tools-6.4.0.GA.pom
[INFO] Downloaded: http://nexus3.cicd.svc.cluster.local:8081/repository/offline/org/jboss/bom/eap/jboss-javaee-6.0-with-tools/6.4.0.GA/jboss-javaee-6.0-with-tools-6.4.0.GA.pom (8 KB at 45.8 KB/sec)
[INFO] Downloading: http://nexus3.cicd.svc.cluster.local:8081/repository/offline/org/jboss/bom/eap/jboss-eap-bom-parent/6.4.0.GA/jboss-eap-bom-parent-6.4.0.GA.pom
[INFO] Downloaded: http://nexus3.cicd.svc.cluster.local:8081/repository/offline/org/jboss/bom/eap/jboss-eap-bom-parent/6.4.0.GA/jboss-eap-bom-parent-6.4.0.GA.pom (7 KB at 252.4 KB/sec)

[....]

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 16.548 s
[INFO] Finished at: 2018-04-03T20:24:23+00:00
[INFO] Final Memory: 21M/60M
[INFO] ------------------------------------------------------------------------
Copying all war artifacts from /tmp/src/target directory into /opt/eap/standalone/deployments for later deployment...
Copying all ear artifacts from /tmp/src/target directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /tmp/src/target directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /tmp/src/target directory into /opt/eap/standalone/deployments for later deployment...
Copying all war artifacts from /tmp/src/deployments directory into /opt/eap/standalone/deployments for later deployment...
'/tmp/src/deployments/ROOT.war' -&gt; '/opt/eap/standalone/deployments/ROOT.war'
Copying all ear artifacts from /tmp/src/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /tmp/src/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /tmp/src/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying config files from project...
'/tmp/src/configuration/application-roles.properties' -&gt; '/opt/eap/standalone/configuration/application-roles.properties'
'/tmp/src/configuration/application-users.properties' -&gt; '/opt/eap/standalone/configuration/application-users.properties'
Pushing image docker-registry.default.svc:5000/tasks/tasks:latest ...
Pushed 0/7 layers, 1% complete
Pushed 1/7 layers, 22% complete
Pushed 2/7 layers, 50% complete
Pushed 3/7 layers, 58% complete
Pushed 4/7 layers, 82% complete
Pushed 5/7 layers, 87% complete
Pushed 6/7 layers, 91% complete
Pushed 7/7 layers, 100% complete
Push successful</code></pre></div></div>
<div class="ulist"><ul><li><p>When the build finishes, the application deploys.</p></li></ul></div></li><li><p>Again, follow the pod logs to make sure the application started successfully (replacing <code>xxxxx</code> with your specific pod name):</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="sh language-sh">oc logs -f tasks-1-xxxxx</code></pre></div></div>
<div class="listingblock"><div class="title">Sample Output</div><div class="content"><pre class="highlight nowrap"><code class="texinfo language-texinfo">WARNING: Service account has insufficient permissions to view pods in kubernetes (HTTP 403). Clustering might be unavailable. Please refer to the documentation for configuration.
INFO: Configuring JGroups discovery protocol to openshift.KUBE_PING
Using PicketBox SSL configuration.
Missing SSO_URL. Unable to properly configure SSO-enabled applications
Access log is disabled, ignoring configuration.
Running jboss-eap-7/eap70-openshift image, version 1.7
-XX:+UseParallelGC -XX:MinHeapFreeRatio=20 -XX:MaxHeapFreeRatio=40 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90 -XX:MaxMetaspaceSize=100m -XX:+ExitOnOutOfMemoryError
=========================================================================
  JBoss Bootstrap Environment
  JBOSS_HOME: /opt/eap

[...]

20:25:23,193 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 38) WFLYSRV0010: Deployed "activemq-rar.rar" (runtime-name : "activemq-rar.rar")
20:25:23,317 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management
20:25:23,317 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0054: Admin console is not enabled
20:25:23,317 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: JBoss EAP 7.0.9.GA (WildFly Core 2.1.20.Final-redhat-1) started in 13863ms - Started 593 of 892 services (515 services are lazy, passive or on-demand)</code></pre></div></div></li><li><p>Access the newly deployed application from your web browser at <code>http://tasks-tasks.apps.$GUID.example.opentlc.com</code>.</p></li></ol></div></div></div></div>
<div class="sect1"><h2 id="_review_lab_accomplishments">5. Review Lab Accomplishments</h2><div class="sectionbody"><div class="paragraph"><p>This completes the lab. You are now able to successfully do the following:</p></div>
<div class="ulist"><ul><li><p>Deploy a disconnected OpenShift cluster</p></li><li><p>Configure CI/CD tools on it</p></li><li><p>Get appropriate dependencies and push them to the CI/CD tools</p></li><li><p>Build a JEE application and access it</p></li></ul></div></div></div></div><div id="footer"><div id="footer-text"><br>Build Version: 3.0.3   :   Last updated 2019-08-11 03:48:07 EDT</div></div></body></html>